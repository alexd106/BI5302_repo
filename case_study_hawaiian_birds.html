<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Alex Douglas" />


<title>BI5302 Hawaiian birds case study practical</title>

<script src="site_libs/header-attrs-2.5/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">BI5302</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    R Book
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://intro2r.com">
        <span class="fa fa-firefox"></span>
         
        Web book
      </a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="https://github.com/alexd106/Rbook/raw/master/docs/Rbook.pdf">
        <span class="fa fa-file-pdf"></span>
         
        PDF book
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="exercises.html">
    <span class="fa fa-book"></span>
     
    Exercises
  </a>
</li>
<li>
  <a href="data.html">
    <span class="fa fa-download"></span>
     
    Data
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-question-circle"></span>
     
    Info
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="resources.html">
        <span class="fa fa-book"></span>
         
        Resources
      </a>
    </li>
    <li>
      <a href="https://github.com/alexd106/BI5302_repo">
        <span class="fa fa-github fa-lg"></span>
         
        Source code
      </a>
    </li>
    <li>
      <a href="https://twitter.com/Scedacity">
        <span class="fa fa-twitter fa-lg"></span>
         
        Twitter
      </a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">BI5302 Hawaiian birds case study practical</h1>
<h4 class="author">Alex Douglas</h4>
<h4 class="date">18 November, 2020</h4>

</div>


<p> </p>
<p>Setup global options for knitr package. Normally I wouldn’t display these but I’ll leave them here for your information. The arguments <code>width.cutoff</code> and <code>tidy = TRUE</code> keeps the displayed code within the code boxes (see what happens if you omit this).</p>
<p> </p>
<pre class="r"><code>knitr::opts_chunk$set(echo=TRUE,tidy.opts=list(width.cutoff=55),tidy=TRUE)</code></pre>
<p> </p>
<p>These data were collected from bird surveys conducted on two Hawaiian islands (Maui and Oahu) from 1956 - 2003. The annual abundance of black-necked stilts (<em>Himantopus mexicanus knudseni</em>) was measured each winter using transect surveys on each island. Along with bird counts, annual rainfall data for the region was also obtained from the National Climate Data Center. The researchers were interested in understanding whether levels of rainfall impacted on bird abundance and whether any impact was different between the two islands.</p>
<p> </p>
<p>1. Create a new R markdown document in your BI5302 RStudio project and save it using a suitable file name. I suggest you specify the default output format as html but feel free to experiment with pdf (you can always change this later). Use this R markdown document to record your data exploration, statistical analysis (including graphs and tables) and commentary. For this exercise I would also suggest that you embed your R code as visible chunks within the document (use <code>echo = TRUE</code>) for later reference.</p>
<p> </p>
<p>Import all the packages required for this exercise:</p>
<p> </p>
<pre class="r"><code>library(lattice)
library(car)
library(nlme)
library(effects)</code></pre>
<p> </p>
<p>2. Import the <code>hawaii3.txt</code> dataset into R and assign it to a suitably named variable. Remember if you’re using R version &gt; 4.0.0 (most of you will be) then columns containing character strings will be imported into R as character type variables not as factors by default. You can either use the argument <code>stringsAsFactors = TRUE</code> when you use the <code>read.table()</code> function to automatically convert character type variables to factors when you import your data or you can use the <code>read.table()</code> function without the <code>stringsAsFactors = TRUE</code> argument and then covert them after you import your data. Examine the structure of the dataframe.</p>
<p> </p>
<pre class="r"><code>dataf &lt;- read.table(&quot;data/hawaii3.txt&quot;, header = TRUE, stringsAsFactors = TRUE)
str(dataf)
## &#39;data.frame&#39;:    96 obs. of  4 variables:
##  $ abund   : int  220 151 183 161 264 192 117 239 263 128 ...
##  $ rainfall: num  33.1 12.5 22.2 11.8 41.6 15.6 4.5 40.1 42.1 7.6 ...
##  $ year    : int  1956 1957 1958 1959 1960 1961 1962 1963 1964 1965 ...
##  $ location: Factor w/ 2 levels &quot;Maui&quot;,&quot;Oahu&quot;: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<p> </p>
<p>3. How many observations are there for each island?</p>
<p> </p>
<pre class="r"><code>library(knitr)
kable(table(dataf$location))</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left;">
Var1
</th>
<th style="text-align:right;">
Freq
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Maui
</td>
<td style="text-align:right;">
48
</td>
</tr>
<tr>
<td style="text-align:left;">
Oahu
</td>
<td style="text-align:right;">
48
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>4. Explore these data graphically. Are there any obvious outliers in the <code>abund</code> variable for each of the <code>locations</code> variable levels (perhaps the <code>dotchart()</code> function with the <code>group</code> argument might help)? Next, use an <code>xyplot</code> (from the <code>lattice</code> package) or a <code>coplot</code> to explore any relationships between bird abundance and rainfall for each of the two islands Finally, create a plot to examine how bird abundance changes over time (<code>year</code>) for each of the two islands.</p>
<p> </p>
<pre class="r"><code>dotchart(dataf$abund, groups = dataf$location, col = as.numeric(dataf$location), 
    xlab = &quot;Bird abundance&quot;, ylab = &quot;Order of observations&quot;)</code></pre>
<p><img src="case_study_hawaiian_birds_files/figure-html/q4a-1.png" width="432" style="display: block; margin: auto;" /></p>
<p> </p>
<p>There doesn’t appear to be any obvious outliers in the <code>abund</code> variable for each island. However this plot does indicate that the ‘spread’ of bird abundance values is much greater for Oahu than for Maui. Hopefully, our linear model will be able to account for this.</p>
<p> </p>
<pre class="r"><code>xyplot(abund ~ rainfall | location, data = dataf, ylab = &quot;bird abundance&quot;)</code></pre>
<p><img src="case_study_hawaiian_birds_files/figure-html/q4b-1.png" width="432" style="display: block; margin: auto;" /></p>
<p> </p>
<p>There appears to be a positive relationship between bird abundance and rainfall. The relationship seems to be more apparent for Maui compared to Oahu.</p>
<p>Now let’s take a look at the change in bird abundance over time on each island.</p>
<p> </p>
<pre class="r"><code>xyplot(abund ~ year | location, data = dataf, ylim = c(0, 
    800), ylab = &quot;bird abundance&quot;)</code></pre>
<p><img src="case_study_hawaiian_birds_files/figure-html/q4c-1.png" width="432" style="display: block; margin: auto;" /></p>
<p> </p>
<p>Looks like there may be a small decrease in bird abundance for birds sampled on Maui. The decrease on Oahu looks to be more apparent although there seems to be quite a lot of between year variability.</p>
<p> </p>
<p>5. With reference to the study aims stated above, fit an appropriate linear model to these data using the <code>lm()</code> function.</p>
<p> </p>
<p>So lets fit a linear model to explain the variability in bird abundance by rainfall and location. We’ll also include the interaction term between rainfall and location to see if any relationship is different between the two islands. I have also included the <code>year</code> variable as an additive effect as I want to try to account for the fact that these observations are potentially non-independent.</p>
<p> </p>
<pre class="r"><code>birds_lm &lt;- lm(abund ~ rainfall + location + year + rainfall:location, 
    data = dataf)</code></pre>
<p> </p>
<p>6. Use appropriate residual plots to identify whether the modelling assumptions are met. Don’t forget to also plot the residuals from this model against all explanatory variables (including <code>year</code>). Can you see a problem? Can you assume homogeneity of variance of the residuals from your model? If not, then try to identify the cause of this problem. Make sure you describe and discuss this process in your R markdown document.</p>
<p> </p>
<p>Let’s plot the usual model validation plots by plotting the model object.</p>
<p> </p>
<pre class="r"><code>par(mfrow = c(2, 2))
plot(birds_lm)</code></pre>
<p><img src="case_study_hawaiian_birds_files/figure-html/q6a-1.png" width="528" style="display: block; margin: auto;" /></p>
<p> </p>
<p>From the Residuals vs Fitted and Scale-Location plots (left-hand side) there seems to be a hint of heterogeneity of variance. On the Residuals vs Fitted plot the spread of the residuals is narrower for smaller fitted values compared to larger fitted values resulting in a slight fan shaped pattern. The QQ-plot suggests that the residuals are approximately normally distributed. The residuals vs leverage plot indicates that none of our residuals are unusual or influential. Looks good so far!</p>
<p>So, to investigate the issue of heterogeneity of variance further let’s plot our residuals against each explanatory variable. First we can plot the residuals from our linear model against the <code>location</code> variable.</p>
<p> </p>
<pre class="r"><code>plot(resid(birds_lm) ~ dataf$location, xlab = &quot;location&quot;, 
    ylab = &quot;Residuals&quot;)
abline(h = 0, lty = 2, col = 2)</code></pre>
<p><img src="case_study_hawaiian_birds_files/figure-html/q6b-1.png" width="364.8" style="display: block; margin: auto;" /></p>
<p> </p>
<p>There are clear differences in the residual variance between each of the islands. Oahu has a much wider spread in residuals compared to Maui indicating a heterogeneity of variance associated with location.</p>
<p>We should also plot the residuals from our model against the <code>rainfall</code> explanatory variable.</p>
<p> </p>
<pre class="r"><code>plot(resid(birds_lm) ~ dataf$rainfall, xlab = &quot;rainfall&quot;, 
    ylab = &quot;Residuals&quot;)
abline(h = 0, lty = 2, col = 2)</code></pre>
<p><img src="case_study_hawaiian_birds_files/figure-html/q6c-1.png" width="364.8" style="display: block; margin: auto;" /></p>
<p> </p>
<p>Not a huge amount to worry about here. There doesn’t seem to be any heterogeneity of variance associated with the <code>rainfall</code> variable. Let’s be extra cautious though and plot the residuals from our model against the <code>rainfall</code> variable again but separately for each island.</p>
<p> </p>
<pre class="r"><code>xyplot(resid(birds_lm) ~ rainfall | location, data = dataf, 
    xlab = &quot;rainfall&quot;, ylab = &quot;Residuals&quot;)</code></pre>
<p><img src="case_study_hawaiian_birds_files/figure-html/q6d-1.png" width="364.8" style="display: block; margin: auto;" /></p>
<p> </p>
<p>So the residuals look OK. We can still see that there is a different spread of our residuals between location which we picked up in our previous diagnostic plot.</p>
<p> </p>
<p>Also, don’t forget we need to check the independence of residuals assumptions as these data were collected from both islands each year from 1956 - 2003. The best way to do this is to plot the residuals against the <code>year</code> variable for each island (<code>location</code>).</p>
<p> </p>
<pre class="r"><code>xyplot(resid(birds_lm) ~ year | location, data = dataf, 
    xlab = &quot;year&quot;, ylab = &quot;Residuals&quot;)</code></pre>
<p><img src="case_study_hawaiian_birds_files/figure-html/q6e-1.png" width="364.8" style="display: block; margin: auto;" /></p>
<p>Oh dear, there are clear patterns in our residuals over time indicating issues with non-independence. The pattern is perhaps strongest for Maui but there also appears to be a downward trend in our residuals for Oahu.</p>
<p> </p>
<p>So for this dataset and our simple linear model, we cannot assume that our residuals have equal variance, probably due to differences between Oahu and Maui, and that our residuals are not independent. In other words, we need to go and fit a model that takes both of these factors into account. We’ll fit this type of model during week 3 of the course.</p>
<p> </p>
<p>###Session Information</p>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 4.0.3 (2020-10-10)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Catalina 10.15.7
## 
## Matrix products: default
## BLAS:   /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_GB.UTF-8/en_GB.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] kableExtra_1.3.1 pander_0.6.3     htmltools_0.5.0  AICcmodavg_2.3-1 stringr_1.4.0    dplyr_1.0.2     
##  [7] knitr_1.30       car_3.0-10       rms_6.0-1        SparseM_1.78     Hmisc_4.4-1      Formula_1.2-4   
## [13] survival_3.2-7   lattice_0.20-41  ggplot2_3.3.2    effects_4.2-0    carData_3.0-4    nlme_3.1-150    
## 
## loaded via a namespace (and not attached):
##   [1] TH.data_1.0-10      VGAM_1.1-4          minqa_1.2.4         colorspace_1.4-1    ellipsis_0.3.1     
##   [6] rio_0.5.16          rsconnect_0.8.16    estimability_1.3    htmlTable_2.1.0     base64enc_0.1-3    
##  [11] rstudioapi_0.11     farver_2.0.3        MatrixModels_0.4-1  fansi_0.4.1         mvtnorm_1.1-1      
##  [16] xml2_1.3.2          codetools_0.2-18    splines_4.0.3       nloptr_1.2.2.2      cluster_2.1.0      
##  [21] png_0.1-7           httr_1.4.2          compiler_4.0.3      backports_1.2.0     assertthat_0.2.1   
##  [26] Matrix_1.2-18       survey_4.0          cli_2.1.0           formatR_1.7         quantreg_5.75      
##  [31] tools_4.0.3         gtable_0.3.0        glue_1.4.2          tinytex_0.27        Rcpp_1.0.5         
##  [36] cellranger_1.1.0    raster_3.3-13       vctrs_0.3.4         conquer_1.0.2       insight_0.10.0     
##  [41] xfun_0.19           rvest_0.3.6         openxlsx_4.2.3      lme4_1.1-25         lifecycle_0.2.0    
##  [46] statmod_1.4.35      polspline_1.1.19    MASS_7.3-53         zoo_1.8-8           scales_1.1.1       
##  [51] hms_0.5.3           parallel_4.0.3      sandwich_3.0-0      RColorBrewer_1.1-2  yaml_2.2.1         
##  [56] curl_4.3            gridExtra_2.3       rpart_4.1-15        latticeExtra_0.6-29 stringi_1.5.3      
##  [61] highr_0.8           checkmate_2.0.0     boot_1.3-25         zip_2.1.1           rlang_0.4.8        
##  [66] pkgconfig_2.0.3     matrixStats_0.57.0  evaluate_0.14       purrr_0.3.4         htmlwidgets_1.5.2  
##  [71] labeling_0.4.2      tidyselect_1.1.0    plyr_1.8.6          magrittr_1.5        R6_2.5.0           
##  [76] generics_0.1.0      multcomp_1.4-14     DBI_1.1.0           pillar_1.4.6        haven_2.3.1        
##  [81] foreign_0.8-80      withr_2.3.0         abind_1.4-5         sp_1.4-4            nnet_7.3-14        
##  [86] tibble_3.0.4        crayon_1.3.4        rmarkdown_2.5       jpeg_0.1-8.1        grid_4.0.3         
##  [91] readxl_1.3.1        data.table_1.13.2   forcats_0.5.0       webshot_0.5.2       digest_0.6.27      
##  [96] xtable_1.8-4        stats4_4.0.3        munsell_0.5.0       unmarked_1.0.1      viridisLite_0.3.0  
## [101] mitools_2.4</code></pre>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
